@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix ff: <https://foerderfunke.org/default#> .

ff:CalculateAgeFromBirthdate a ff:MaterializationRule, ff:SparqlRule ;
    rdfs:label "Calculate the age from the birthdate" ;
    ff:input ff:hasBirthday ;
    ff:output ff:hasAge ;
    ff:suggestPermanentMaterialization true ;
    ff:ifPermanentlyMaterializedAddPeriodicCheck "on-app-startup" ;
    ff:sparqlConstructQuery """
        PREFIX ff: <https://foerderfunke.org/default#>
        CONSTRUCT {
            ?person ff:hasAge ?age .
        } WHERE {
            ?person ff:hasBirthday ?bday .
            BIND(YEAR(NOW()) - YEAR(?bday) - IF(MONTH(NOW()) < MONTH(?bday) || (MONTH(NOW()) = MONTH(?bday) && DAY(NOW()) < DAY(?bday)), 1, 0) AS ?age) .
        }
    """ .
