@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix ff: <https://foerderfunke.org/default#> .
@prefix shn: <https://schemas.link/shacl-next#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .

ff:uebergangsgeld a ff:RequirementProfile ;
    ff:title "Übergangsgeld für Menschen mit Behinderung - Bundesagentur für Arbeit"@de ,
        "Transitional Allowance for People with Disabilities - Federal Employment Agency"@en ;
    ff:category ff:schule-studium-ausbildung-bc-kategorie, ff:gesundheit-pflege-bc-kategorie, ff:sozialhilfe-grundsicherung-bc-kategorie ;
    ff:validationStage ff:preliminary-validation ;
    ff:legalBasis ff:sgb-iii, ff:sgb-ix ;
    ff:administrativeLevel ff:bund ;
    ff:providingAgency ff:bundesagentuFuerArbeit ;
    ff:tag ff:beta ;
    ff:benefitInfo "Menschen mit Behinderungen können zur Sicherung des Lebensunterhaltes Übergangsgeld erhalten, wenn sie an bestimmten Bildungsmaßnahmen teilnehmen. Je nach Rehabilitionträger gelten hier unterschiedliche Voraussetzungen und Leistungsangebote. Die vorliegende Leistung steht Menschen zur Verfügung, deren Rehabilitationsträger die Bundesagentur für Arbeit ist."@de ,
        "People with disabilities can receive transitional allowance to cover their living expenses if they participate in specific educational programs. Depending on the rehabilitation provider, different requirements and benefits apply. This benefit is available to people whose rehabilitation provider is the Federal Employment Agency."@en ;
    rdfs:seeAlso <https://www.arbeitsagentur.de/datei/uebergangsgeld-fuer-rehabilitanden-der-ba_ba040009.pdf> ;
    ff:hasMainShape ff:uebergangsgeldMainShape ;
    ff:hasFlowShape ff:uebergangsgeldFlowShape .

# ----- EVALUATION LOGIC -----

ff:uebergangsgeldMainShape a sh:NodeShape ;
    sh:targetClass ff:Citizen ;

    sh:property [ sh:path ff:disability ; sh:in (true) ] ;
    sh:property [ sh:path ff:rehabilitationProvider ; sh:in (ff:rehabilitationProvider-bundesagenturFuerArbeit) ] ;
    sh:property [
        sh:or (
            [ sh:property [ sh:path ff:vocationalTrainingRecent ; sh:in (true) ] ]
            [ 
                sh:property [ sh:path ff:vocationalTrainingRecent ; sh:in (false) ] ;
                sh:or (
                    [ 
                        sh:property [ sh:path ff:careerReturner ; sh:in (false) ] ;
                        sh:or (
                            [ sh:property [ sh:path ff:socialInsurance12MonthsLast3Years ; sh:in (true) ] ]
                            [ sh:property [ sh:path ff:unemploymentBenefitApprovedLast3Years ; sh:in (true) ] ]
                        )
                    ]
                    [ 
                        sh:property [ sh:path ff:careerReturner ; sh:in (true) ] ;
                        sh:or (
                            [ sh:property [ sh:path ff:socialInsurance12Months ; sh:in (true) ] ]
                            [ sh:property [ sh:path ff:unemploymentBenefitApproved ; sh:in (true) ] ]
                        )
                    ]
                )
            ]
        )
    ] .

# ----- DECISION TREE LOGIC -----

ff:uebergangsgeldFlowShape a sh:NodeShape ;
    sh:targetClass ff:Citizen ;

    sh:property ff:baseRequirements ;
    sh:property ff:educationPS ;
    sh:property ff:returningProfessionalPS ;
    sh:property ff:priorEmploymentPeriod3YearsPS ;
    sh:property ff:priorEmploymentPeriodPS .

ff:baseRequirements a sh:PropertyShape ;
    sh:property [ sh:path ff:disability ; sh:minCount 1 ] ;
    sh:property [ sh:path ff:rehabilitationProvider ; sh:minCount 1 ] .

ff:educationPS a sh:PropertyShape ;
    sh:deactivated [
        sh:not [ sh:and (
            [ shn:eq ( [ sh:path ff:disability ] true ) ] 
            [ shn:eq ( [ sh:path ff:rehabilitationProvider ] ff:rehabilitationProvider-bundesagentuFuerArbeit ) ] 
        ) ]
    ] ;
    sh:path ff:vocationalTrainingRecent ;
    sh:minCount 1 .

ff:returningProfessionalPS a sh:PropertyShape ;
    sh:deactivated [
        sh:not [ 
            sh:and (
                [ shn:eq ( [ sh:path ff:disability ] true ) ] 
                [ shn:eq ( [ sh:path ff:rehabilitationProvider ] ff:rehabilitationProvider-bundesagentuFuerArbeit ) ] 
                [ shn:eq ( [ sh:path ff:vocationalTrainingRecent ] false ) ]
            ) 
        ]
    ] ;
    sh:path ff:careerReturner ;
    sh:minCount 1 .

ff:priorEmploymentPeriod3YearsPS a sh:PropertyShape ;
    sh:deactivated [
        sh:not [ 
            sh:and (
                [ shn:eq ( [ sh:path ff:disability ] true ) ] 
                [ shn:eq ( [ sh:path ff:rehabilitationProvider ] ff:rehabilitationProvider-bundesagentuFuerArbeit ) ]
                [ shn:eq ( [ sh:path ff:vocationalTrainingRecent ] false ) ]
                [ shn:eq ( [ sh:path ff:careerReturner ] false ) ]
            ) 
        ] 
    ] ;
    sh:property [ sh:path ff:socialInsurance12MonthsLast3Years ; sh:minCount 1 ] ;
    sh:property [ sh:path ff:unemploymentBenefitApprovedLast3Years ; sh:minCount 1 ] .

ff:priorEmploymentPeriodPS a sh:PropertyShape ;
    sh:deactivated [
        sh:not [ 
            sh:and (
                [ shn:eq ( [ sh:path ff:disability ] true ) ] 
                [ shn:eq ( [ sh:path ff:rehabilitationProvider ] ff:rehabilitationProvider-bundesagentuFuerArbeit ) ] 
                [ shn:eq ( [ sh:path ff:vocationalTrainingRecent ] false ) ]
                [ shn:eq ( [ sh:path ff:careerReturner ] true ) ]
            ) 
        ] 
    ] ;
    sh:property [ sh:path ff:socialInsurance12Months ; sh:minCount 1 ] ;
    sh:property [ sh:path ff:unemploymentBenefitApproved ; sh:minCount 1 ] .
