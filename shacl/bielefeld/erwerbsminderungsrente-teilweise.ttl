@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix ff: <https://foerderfunke.org/default#> .
@prefix shn: <https://schemas.link/shacl-next#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .

ff:erwerbsminderungsrente-teilweise a ff:RequirementProfile ;
    ff:title "Rente wegen teilweiser Erwerbsminderung"@de ,
                "Pension for Partial Disability"@en ;
    ff:category ff:gesundheit-pflege-bc-kategorie, ff:sozialhilfe-grundsicherung-bc-kategorie ;
    ff:validationStage ff:preliminary-validation ;
    ff:legalBasis ff:sgb-vi ;
    ff:administrativeLevel ff:bund ;
    ff:providingAgency ff:sozialamt ;
    ff:tag ff:bielefunke ;
    ff:benefitInfo "Die Rente wegen teilweiser Erwerbsminderung ist eine Leistung der gesetzlichen Rentenversicherung für Versicherte, die aufgrund von Krankheit oder Behinderung nicht mehr in der Lage sind, vollständig am allgemeinen Arbeitsmarkt erwerbstätig zu sein."@de ,
        "The pension for partial disability is a benefit of the statutory pension insurance for insured persons who, due to illness or disability, are no longer able to work fully in the general labor market."@en ;
    ff:moreInfoAt <https://raw.githubusercontent.com/Citizen-Knowledge-Graph/foerderfunke-react-app/refs/heads/main/public/assets/data/requirement-profiles/requirement-profiles-hydration.json> ;
    ff:hasMainShape ff:erwerbsminderungsrenteTeilweiseMainShape ;
    ff:hasFlowShape ff:erwerbsminderungsrenteTeilweiseFlowShape .

# ----- EVALUATION LOGIC -----

ff:erwerbsminderungsrenteTeilweiseMainShape a sh:NodeShape ;
    sh:targetClass ff:Citizen ;

    sh:property [ sh:path ff:pensionable ; sh:in (false) ] ;
    sh:property [
        sh:and (
            sh:property [ sh:path ff:workAbility ; sh:in (ff:workAbility-limited) ] 
            sh:property [ sh:path ff:workAbilityHours ; sh:minInclusive 3 ; sh:maxInclusive 6 ]
        )
    ] ;
    sh:property [
        sh:or (
            [ sh:property [ sh:path ff:reducedEarningCapacityCause ; sh:in (true) ] ]
            [   
                sh:and (
                    sh:property [ sh:path ff:statutoryPensionFiveYears ; sh:in (true) ] 
                    sh:property [ sh:path ff:statutoryPension36Months5Years ; sh:in (true) ]
                )
            ]
        )
    ] .
    
# ----- DECISION TREE LOGIC -----

ff:erwerbsminderungsrenteTeilweiseFlowShape a sh:NodeShape ;
    sh:targetClass ff:Citizen ;

    sh:property ff:baseRequirements ;
    sh:property ff:reducedEarningsCapacityPS ;
    sh:property ff:specialCauseInabilityPS ;
    sh:property ff:waitingPeriodPS .

ff:baseRequirements a sh:PropertyShape ;
    sh:property [ sh:path ff:birthDate ; sh:minCount 1 ] .

ff:reducedEarningsCapacityPS a sh:PropertyShape ;
    sh:deactivated [
        sh:not [ shn:eq ( [ sh:path ff:pensionable ] false ) ]
    ] ;
    sh:property [ sh:path ff:workAbility ; sh:minCount 1 ] ;
    sh:property [ sh:path ff:workAbilityHours ; sh:minCount 1 ] .

ff:specialCauseInabilityPS a sh:PropertyShape ;
    sh:deactivated [
        sh:not [ 
            sh:and (
                [ shn:eq ( [ sh:path ff:workAbility ] true ) ]
                [ sh:path ff:workAbilityHours ; sh:minInclusive 3 ; sh:maxInclusive 6 ]
            )
        ]
    ] ;
    sh:property [ sh:path ff:reducedEarningCapacityCause ; sh:minCount 1 ] .

ff:waitingPeriodPS a sh:PropertyShape ;
    sh:deactivated [
        sh:not [ shn:eq ( [ sh:path ff:reducedEarningCapacityCause ] false ) ]
    ] ;
    sh:property [ sh:path ff:statutoryPensionFiveYears ; sh:minCount 1 ] ;
    sh:property [ sh:path ff:statutoryPension36Months5Years ; sh:minCount 1 ] .
