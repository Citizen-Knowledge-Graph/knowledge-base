@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix ff: <https://foerderfunke.org/default#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix shn: <https://schemas.link/shacl-next#> .

ff:wolfenbuettel-stiftung a ff:RequirementProfile ;
    ff:title "Wolfenbüttel Stiftung"@de , "Wolfenbüttel Foundation"@en ;
    ff:category ff:stiftungs-foerderung ;
    ff:validationStage ff:preliminary-validation ;
    ff:tag ff:beta , ff:wolfenbuettel ;
    ff:benefitInfo "Die Wolfenbüttel-Stiftung unterstützt bedürftige Kinder, hilfsbedürftige ältere Menschen und soziale Projekte in Wolfenbüttel – ohne Rechtsanspruch auf Förderung."@de ,
        "The Wolfenbüttel Foundation supports needy children, needy elderly people and social projects in Wolfenbüttel - without a legal claim to funding."@en ;
    rdfs:seeAlso <https://www.wolfenbuettel.de/index.php?ModID=7&FID=2672.9007.1&object=tx%7C2672.9007.1> ;
    ff:hasMainShape ff:wolfenbuettel-stiftungMainShape ;
    ff:hasFlowShape ff:wolfenbuettel-stiftungFlowShape .

# ----- EVALUATION LOGIC -----

ff:wolfenbuettel-stiftungMainShape a sh:NodeShape ;
    sh:targetClass ff:Citizen ;

    sh:property [
        sh:path ff:residenceInWolfenbuettel ;
        sh:in ( true )
    ] ;

    sh:property [
        sh:or (
            [ sh:property [ sh:path ff:financialDifficulty ; sh:in ( true ) ] ]
            [
                sh:and (
                    [ sh:property [sh:path ff:activeInAssociation ; sh:in ( true ) ] ]
                    [
                        sh:property [
                            sh:or (
                                [ sh:path ff:associationActivity ; sh:maxCount 0 ]
                                [ sh:path ff:associationActivity ; sh:hasValue ff:associationActivity-youthWork ]
                                [ sh:path ff:associationActivity ; sh:hasValue ff:associationActivity-womenSupport ]
                            )
                        ]
                    ]
                )
            ]
        )
    ] ;

    sh:property [
        sh:path ff:wbFoundationPreviousYear ;
        sh:in ( false ) ;
    ] .

# ----- DECISION TREE LOGIC -----

ff:wolfenbuettel-stiftungFlowShape a sh:NodeShape ;
    sh:targetClass ff:Citizen ;

    sh:property ff:baseRequirements ;
    sh:property ff:wbFoundationPreviousYearPS ;
    sh:property ff:financialDifficultyPS ;
    sh:property ff:associationActivityPS ;
    sh:property ff:associationActivityTypePS .

ff:baseRequirements a sh:PropertyShape ;    
    sh:property [ sh:path ff:residenceInWolfenbuettel ; sh:minCount 1 ] .

ff:wbFoundationPreviousYearPS a sh:PropertyShape ;
    sh:deactivated [
        sh:not [
            shn:eq ( [ sh:path ff:residenceInWolfenbuettel ] true ) 
        ]
    ] ;
    sh:property [ sh:path ff:wbFoundationPreviousYear ; sh:minCount 1 ] .

ff:financialDifficultyPS a sh:PropertyShape ;
    sh:deactivated [
        sh:not [
            shn:eq ( [ sh:path ff:wbFoundationPreviousYear ] false ) 
        ]
    ] ;
    sh:property [ sh:path ff:financialDifficulty ; sh:minCount 1 ] .

ff:associationActivityPS a sh:PropertyShape ;
    sh:deactivated [
        sh:not [
            shn:eq ( [ sh:path ff:financialDifficulty ] false ) 
        ]
    ] ;
    sh:property [ sh:path ff:activeInAssociation ; sh:minCount 1 ] .

ff:associationActivityTypePS a sh:PropertyShape ;
    sh:deactivated [
        sh:not [
            shn:eq ( [ sh:path ff:activeInAssociation ] true ) 
        ]
    ] ;
    sh:property [ sh:path ff:associationActivity ; sh:minCount 1 ] .
