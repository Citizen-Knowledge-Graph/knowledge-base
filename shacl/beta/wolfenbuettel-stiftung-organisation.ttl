@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix ff: <https://foerderfunke.org/default#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix shn: <https://schemas.link/shacl-next#> .

ff:wfsto a ff:RequirementProfile ;
    ff:title "Wolfenbüttel Stiftung - Organisation"@de , "Wolfenbüttel Foundation - Organisation"@en ;
    ff:category ff:stiftungs-foerderung ;
    ff:validationStage ff:preliminary-validation ;
    ff:tag ff:beta , ff:wolfenbuettel ;
    ff:targetClass ff:Organisation ; # workaround - support multiple profile classes fully the future TODO
    ff:benefitInfo "Die Wolfenbüttel-Stiftung unterstützt soziale Projekte in Wolfenbüttel – ohne Rechtsanspruch auf Förderung."@de ,
        "The Wolfenbüttel Foundation supports social projects in Wolfenbüttel - without a legal claim to funding."@en ;
    rdfs:seeAlso <https://www.wolfenbuettel.de/index.php?ModID=7&FID=2672.9007.1&object=tx%7C2672.9007.1> ;
    ff:hasMainShape ff:wfstoMainShape ;
    ff:hasFlowShape ff:wfstoFlowShape .

# ----- EVALUATION LOGIC -----

ff:wfstoMainShape a sh:NodeShape ;
    sh:targetClass ff:Citizen ;

    sh:property [
        sh:path ff:activeInAssociation ;
        sh:in ( true )
    ] ;

    sh:property [
        sh:path ff:associationHeadquarters ;
        sh:in ( ff:associationHeadquarters-wolfenbuettel )
    ] ;

    sh:property [
        sh:or (
            [ sh:path ff:associationTargetGroup ; sh:maxCount 0 ]
            [ sh:path ff:associationTargetGroup ; sh:hasValue ff:associationTargetGroup-children ]
            [ sh:path ff:associationTargetGroup ; sh:hasValue ff:associationTargetGroup-youth ]
            [ sh:path ff:associationTargetGroup ; sh:hasValue ff:associationTargetGroup-women ]
            [ sh:path ff:associationTargetGroup ; sh:hasValue ff:associationTargetGroup-sociallyDisadvantaged ]
        )
    ] ;

    sh:property [
        sh:path ff:wbFoundationOrganisationPreviousYear ;
        sh:in ( false ) ;
    ] .

# ----- DECISION TREE LOGIC -----

ff:wfstoFlowShape a sh:NodeShape ;
    sh:targetClass ff:Citizen ;

    sh:property ff:wfstoBaseRequirements ;
    sh:property ff:wfstoHeadquartersLocationPS ;
    sh:property ff:wfstoOrgIsInWbPS .

ff:wfstoBaseRequirements a sh:PropertyShape ;    
    sh:property [ sh:path ff:activeInAssociation ; sh:minCount 1 ] .

ff:wfstoHeadquartersLocationPS a sh:PropertyShape ;
    sh:deactivated [
        sh:not [
            shn:eq ( [ sh:path ff:activeInAssociation ] true )
        ]
    ] ;
    sh:property [ sh:path ff:associationHeadquarters ; sh:minCount 1 ] .

ff:wfstoOrgIsInWbPS a sh:PropertyShape ;
    sh:deactivated [
        sh:not [
            shn:eq ( [ sh:path ff:associationHeadquarters ] ff:associationHeadquarters-wolfenbuettel )
        ]
    ] ;
    sh:property [ sh:path ff:wbFoundationOrganisationPreviousYear ; sh:minCount 1 ] ;
    sh:property [ sh:path ff:associationTargetGroup ; sh:minCount 1 ] .
