@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix ff: <https://foerderfunke.org/default#> .
@prefix shn: <https://schemas.link/shacl-next#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .

ff:substitutionstherapie-diamorphin a ff:RequirementProfile ;
    ff:title "Substitutionstherapie mit Diamorphin"@de ,
              "Substitution Therapy with Diamorphine"@en ;
    ff:category ff:gesundheit-pflege-bc-kategorie ;
    ff:validationStage ff:preliminary-validation ;
    ff:legalBasis ff:betaeubungsmittelgesetz ;
    ff:administrativeLevel ff:bund ;
    ff:providingAgency ff:gesundheitsamt, ff:kassenaerztliche_vereinigung ;
    ff:benefitInfo "Die Substitutionstherapie mit Diamorphin ist eine besondere Form der Behandlung für Menschen, die stark von Heroin abhängig sind und bei denen andere Therapien nicht geholfen haben."@de ,
        "Diamorphine substitution therapy is a special form of treatment for people who are heavily dependent on heroin and for whom other therapies have not helped."@en ;
    ff:hasMainShape ff:substitutionstherapieDiamorphinMainShape ;
    ff:hasFlowShape ff:substitutionstherapieDiamorphinFlowShape .

# ----- EVALUATION LOGIC -----

ff:substitutionstherapieDiamorphinMainShape a sh:NodeShape ;
    sh:targetClass ff:Citizen ;

    sh:property [ sh:path ff:has_confirmed_addiction ; sh:in (true) ] ;
    sh:property [ sh:path ff:has_medical_insurance ; sh:in (true) ] ;
    sh:property [ sh:path ff:hasAge ; sh:minInclusive 18 ] ;
    sh:property [
        sh:or (
            [ sh:property [ sh:path ff:sobriety_wish ; sh:in (true) ] ]
            [ sh:property [ sh:path ff:has_severe_disease ; sh:in (true) ] ]
            [ sh:property [ sh:path ff:pregnant ; sh:in (false) ] ]
            [ sh:property [ sh:path ff:recent_birth ; sh:in (false) ] ]
        )
    ] ;
    sh:property [ sh:path ff:addiction_duration_2years ; sh:in (true) ] ;
    sh:property [ sh:path ff:addiction_damage ; sh:in (true) ] ;
    sh:property [ sh:path ff:substitutiontherapy_regular_unsuccessful ; sh:in (true) ] .
    
# ----- DECISION TREE LOGIC -----

ff:substitutionstherapieDiamorphinFlowShape a sh:NodeShape ;
    sh:targetClass ff:Citizen ;

    sh:property ff:baseRequirements ;
    sh:property ff:circumstanceRequirementsPS ;
    sh:property ff:durationRequirementPS ;
    sh:property ff:addictionDamageRequirementPS ;
    sh:property ff:unsuccessfulTherapyRequirementPS .

ff:baseRequirements a sh:PropertyShape ;
    sh:property [ sh:path ff:has_confirmed_addiction ; sh:minCount 1 ] ;
    sh:property [ sh:path ff:has_medical_insurance ; sh:minCount 1 ] ;
    sh:property [ sh:path ff:geburtsdatum ; sh:minCount 1 ] ;
    sh:property [ sh:path ff:hasAge ; sh:minCount 1 ] .

ff:circumstanceRequirementsPS a sh:PropertyShape ;
    sh:deactivated [
        sh:or (
            [ sh:not [ 
                shn:eq ( [ sh:path ff:has_confirmed_addiction ] true )
            ] ]
            [ sh:not [
                shn:eq ( [ sh:path ff:has_medical_insurance ] true )
            ] ]
            [ sh:not [
                sh:path ff:hasAge ; sh:minInclusive 18
            ] ]
        )
    ] ;
    sh:property [ sh:path ff:sobriety_wish ; sh:minCount 1 ] ;
    sh:property [ sh:path ff:has_severe_disease ; sh:minCount 1 ] ;
    sh:property [ sh:path ff:pregnant ; sh:minCount 1 ] ;
    sh:property [ sh:path ff:recent_birth ; sh:minCount 1 ] .

ff:durationRequirementPS a sh:PropertyShape ;
    sh:deactivated [
        sh:and (
            [ sh:not [ 
                shn:eq ( [ sh:path ff:sobriety_wish ] true )
            ] ]
            [ sh:not [ 
                shn:eq ( [ sh:path ff:has_severe_disease ] true )
            ] ]
            [ sh:not [ 
                shn:eq ( [ sh:path ff:pregnant ] true )
            ] ]
            [ sh:not [ 
                shn:eq ( [ sh:path ff:recent_birth ] true )
            ] ]
        )
    ] ;
    sh:property [ sh:path ff:addiction_duration_2years ; sh:minCount 1 ] .

ff:addictionDamageRequirementPS a sh:PropertyShape ;
    sh:deactivated [
        sh:not [
            shn:eq ( [ sh:path ff:addiction_duration_2years ] true )
        ]
    ] ;
    sh:property [ sh:path ff:addiction_damage ; sh:minCount 1 ] .

ff:unsuccessfulTherapyRequirementPS a sh:PropertyShape ;
    sh:deactivated [
        sh:not [
            shn:eq ( [ sh:path ff:addiction_damage ] true )
        ]
    ] ;
    sh:property [ sh:path ff:substitutiontherapy_regular_unsuccessful ; sh:minCount 1 ] .
