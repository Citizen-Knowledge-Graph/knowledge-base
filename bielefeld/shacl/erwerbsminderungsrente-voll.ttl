@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix ff: <https://foerderfunke.org/default#> .
@prefix shn: <https://schemas.link/shacl-next#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .

ff:erwerbsminderungsrente-voll a ff:RequirementProfile ;
    ff:title "Rente wegen voller Erwerbsminderung"@de ,
              "Pension for Full Disability"@en ;
    ff:category ff:gesundheit-pflege-bc-kategorie, ff:sozialhilfe-grundsicherung-bc-kategorie ;
    ff:validationStage ff:preliminary-validation ;
    ff:legalBasis ff:sgb-vi ;
    ff:administrativeLevel ff:bund ;
    ff:providingAgency ff:sozialamt ;
    ff:tag ff:bielefunke ;
    ff:benefitInfo "Die Rente wegen voller Erwerbsminderung ist eine Leistung der gesetzlichen Rentenversicherung für Versicherte, die aufgrund von Krankheit oder Behinderung dauerhaft nicht mehr in der Lage sind, am allgemeinen Arbeitsmarkt erwerbstätig zu sein."@de ,
        "The pension for full disability is a benefit of the statutory pension insurance for insured persons who, due to illness or disability, are permanently unable to work in the general labor market."@en ;
    ff:hasMainShape ff:erwerbsminderungsrenteVollMainShape ;
    ff:hasFlowShape ff:erwerbsminderungsrenteVollFlowShape .

# ----- EVALUATION LOGIC -----

ff:erwerbsminderungsrenteVollMainShape a sh:NodeShape ;
    sh:targetClass ff:Citizen ;

    sh:property [ sh:path ff:pensionable ; sh:in (false) ] ;
    sh:property [
        sh:or (
            [ sh:property [ sh:path ff:open_market_fit ; sh:in (false) ] ]
            [ 
                sh:and (
                    sh:property [ sh:path ff:open_market_fit ; sh:in (true) ] 
                    sh:property [ sh:path ff:open_market_hours ; sh:in (ff:open_market_hours-3hours) ]
                )
            ]
        )
    ] ;
    sh:property [
        sh:or (
            [ sh:property [ sh:path ff:special_cause_inability ; sh:in (true) ] ]
            [   
                sh:and (
                    sh:property [ sh:path ff:special_cause_inability ; sh:in (false) ] 
                    [ sh:or (
                        [ sh:property [ sh:path ff:extended_waiting_period ; sh:in (true) ] ; ]
                        [    
                            sh:and (
                                sh:property [ sh:path ff:general_waiting_period ; sh:in (true) ] 
                                sh:property [ sh:path ff:compulsory_contributions ; sh:in (true) ]
                            )
                        ]
                    ) ]
                )
            ]
        )
    ] .
    
# ----- DECISION TREE LOGIC -----

ff:erwerbsminderungsrenteVollFlowShape a sh:NodeShape ;
    sh:targetClass ff:Citizen ;

    sh:property ff:baseRequirements ;
    sh:property ff:fullyReducedEarningsCapacityPS ;
    sh:property ff:specialCauseInabilityPS ;
    sh:property ff:waitingPeriodPS .

ff:baseRequirements a sh:PropertyShape ;
    sh:property [ sh:path ff:geburtsdatum ; sh:minCount 1 ] .

ff:fullyReducedEarningsCapacityPS a sh:PropertyShape ;
    sh:deactivated [
        sh:not [ shn:eq ( [ sh:path ff:pensionable ] false ) ]
    ] ;
    sh:property [ sh:path ff:open_market_fit ; sh:minCount 1 ] ;
    sh:property [ sh:path ff:open_market_hours ; sh:minCount 1 ] .

ff:specialCauseInabilityPS a sh:PropertyShape ;
    sh:deactivated [
        sh:not [ 
            sh:or (
                [ shn:eq ( [ sh:path ff:open_market_fit ] false ) ]
                [
                    sh:and (
                        [ shn:eq ( [ sh:path ff:open_market_fit ] true ) ]
                        [ shn:eq ( [ sh:path ff:open_market_hours ] ff:open_market_hours-3hours ) ]
                    )
                ]
            ) 
        ]
    ] ;
    sh:property [ sh:path ff:special_cause_inability ; sh:minCount 1 ] .

ff:waitingPeriodPS a sh:PropertyShape ;
    sh:deactivated [
        sh:not [ shn:eq ( [ sh:path ff:special_cause_inability ] false ) ]
    ] ;
    sh:property [ sh:path ff:extended_waiting_period ; sh:minCount 1 ] ;
    sh:property [ sh:path ff:general_waiting_period ; sh:minCount 1 ] ;
    sh:property [ sh:path ff:compulsory_contributions ; sh:minCount 1 ] .
